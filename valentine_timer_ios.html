<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Countdown to Valentine (iPhone)</title>
<style>
body {
  margin:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:Courier New, monospace;
  text-align:center;
  overflow:hidden;
  color:#ff2a2a;
}
#timer {
  font-size:70px;
  text-shadow:0 0 10px red, 0 0 30px darkred;
}
.shake {
  animation: shake 0.1s infinite;
}
@keyframes shake {
  0% { transform: translate(2px, 2px); }
  25% { transform: translate(-2px, -2px); }
  50% { transform: translate(2px, -2px); }
  75% { transform: translate(-2px, 2px); }
  100% { transform: translate(2px, 2px); }
}
#final {
  display:none;
  font-size:40px;
  color:pink;
  text-shadow:0 0 20px #ff69b4;
}
#redAlert {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:red;
  opacity:0;
  pointer-events:none;
  z-index:10;
}
#flash {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:white;
  opacity:0;
  pointer-events:none;
  z-index:11;
}
#tapScreen {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.7);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:25px;
  z-index:20;
  text-align:center;
}
</style>
</head>
<body>

<div id="timer">00:00:00:00</div>
<div id="final">–æ–≥–æ –±–ª–∏–Ω –∫–æ—Ç—è—Ç–∞ –ª—é–±–ª—é –≤–∞—Å</div>
<div id="redAlert"></div>
<div id="flash"></div>
<div id="tapScreen">–¢–∞–ø–Ω–∏ –ø–æ —ç–∫—Ä–∞–Ω—É, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –∏ —Ç–∞–π–º–µ—Ä üéµ</div>

<script>
let audioCtx;
let audioUnlocked = false;

function unlockAudio() {
    if(audioUnlocked) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    audioUnlocked = true;
    document.getElementById('tapScreen').style.display='none';
    updateTimer(); // —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
}
document.getElementById('tapScreen').addEventListener('click', unlockAudio);

function playBeep(freq, duration, volume=0.3){
  if(!audioUnlocked) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.frequency.value = freq; osc.type = "square";
  gain.gain.value = volume;
  osc.start();
  setTimeout(()=>osc.stop(),duration);
}

function vibrate(pattern){
  if(navigator.vibrate) navigator.vibrate(pattern);
}

// –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è: 14 —Ñ–µ–≤—Ä–∞–ª—è 00:00 –ú–°–ö
function getTimeLeftToMoscow(){
    const now = new Date();
    const nowUTC = Date.UTC(
        now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),
        now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds()
    );

    let year = now.getUTCFullYear();
    let targetUTC = Date.UTC(year,1,13,21,0,0); // 14 —Ñ–µ–≤ 00:00 –ú–°–ö = 13 —Ñ–µ–≤ 21:00 UTC
    if(nowUTC >= targetUTC){
        year +=1;
        targetUTC = Date.UTC(year,1,13,21,0,0);
    }

    let diff = targetUTC - nowUTC;
    if(diff < 0) diff = 0;

    const totalSeconds = Math.floor(diff / 1000);
    const days = Math.floor(totalSeconds / 86400);
    const hours = Math.floor((totalSeconds % 86400)/3600);
    const minutes = Math.floor((totalSeconds % 3600)/60);
    const seconds = totalSeconds % 60;

    return {days,hours,minutes,seconds,totalSeconds};
}

function updateTimer(){
    const timerEl = document.getElementById("timer");
    const redAlert = document.getElementById("redAlert");
    const {days,hours,minutes,seconds,totalSeconds} = getTimeLeftToMoscow();

    if(totalSeconds <=0){
        timerEl.style.display="none";
        document.getElementById("final").style.display="block";

        playBeep(200,1500,0.5);
        vibrate([300,100,300,100,600]);
        const flash=document.getElementById("flash");
        flash.style.transition="opacity 0.2s";
        flash.style.opacity=1;
        setTimeout(()=>flash.style.opacity=0,300);
        redAlert.style.opacity=0;
        timerEl.classList.remove("shake");
        return;
    }

    timerEl.textContent =
        String(days).padStart(2,'0')+":"+
        String(hours).padStart(2,'0')+":"+
        String(minutes).padStart(2,'0')+":"+String(seconds).padStart(2,'0');

    if(totalSeconds <=5){
        timerEl.classList.add("shake");
        redAlert.style.opacity = seconds%2?0.4:0;
        playBeep(1400,120,0.5);
        vibrate(120);
    } else if(totalSeconds <=10){
        playBeep(1200,100,0.4);
        vibrate(80);
        timerEl.classList.remove("shake");
        redAlert.style.opacity = 0;
    } else{
        playBeep(800,50,0.2);
        vibrate(40);
        timerEl.classList.remove("shake");
        redAlert.style.opacity = 0;
    }
}

// –ù–∞ iPhone —Ç–∞–π–º–µ—Ä –±–µ–∑ –∫–ª–∏–∫–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
setInterval(updateTimer,1000);
</script>

</body>
</html>