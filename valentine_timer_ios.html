<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Countdown to Valentine</title>
<style>
body {
  margin:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:Courier New, monospace;
  text-align:center;
  overflow:hidden;
  color:#ff2a2a;
}
#timer {
  font-size:70px;
  text-shadow:0 0 10px red, 0 0 30px darkred;
}
.shake {
  animation: shake 0.1s infinite;
}
@keyframes shake {
  0% { transform: translate(2px, 2px); }
  25% { transform: translate(-2px, -2px); }
  50% { transform: translate(2px, -2px); }
  75% { transform: translate(-2px, 2px); }
  100% { transform: translate(2px, 2px); }
}
#final {
  display:none;
  font-size:40px;
  color:pink;
  text-shadow:0 0 20px #ff69b4;
}
#redAlert {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:red;
  opacity:0;
  pointer-events:none;
  z-index:10;
}
#flash {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:white;
  opacity:0;
  pointer-events:none;
  z-index:11;
}
</style>
</head>
<body>

<div id="timer">00:00:00:00</div>
<div id="final">ого блин котята люблю вас</div>
<div id="redAlert"></div>
<div id="flash"></div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playBeep(freq, duration, volume=0.3){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.frequency.value = freq; osc.type = "square";
  gain.gain.value = volume;
  osc.start();
  setTimeout(()=>osc.stop(),duration);
}

function vibrate(pattern){
  if(navigator.vibrate) navigator.vibrate(pattern);
}

function getMoscowTime(){
  const now = new Date();
  const utc = now.getTime() + now.getTimezoneOffset()*60000;
  return new Date(utc + 3*60*60*1000);
}

function updateTimer(){
  const now = getMoscowTime();
  let year = now.getUTCFullYear();
  let target = new Date(Date.UTC(year,1,14,0,0,0)+3*3600*1000);
  if(now > target) target = new Date(Date.UTC(year+1,1,14,0,0,0)+3*3600*1000);

  const diff = target - now;
  const timerEl = document.getElementById("timer");
  const redAlert = document.getElementById("redAlert");

  if(diff <=0){
    timerEl.style.display="none";
    document.getElementById("final").style.display="block";

    // Финальный взрыв
    playBeep(200,1500,0.5);
    vibrate([300,100,300,100,600]);
    const flash=document.getElementById("flash");
    flash.style.transition="opacity 0.2s";
    flash.style.opacity=1;
    setTimeout(()=>flash.style.opacity=0,300);
    redAlert.style.opacity=0;
    timerEl.classList.remove("shake");
    return;
  }

  const totalSeconds=Math.floor(diff/1000);
  const days=Math.floor(totalSeconds/86400);
  const hours=Math.floor((totalSeconds%86400)/3600);
  const minutes=Math.floor((totalSeconds%3600)/60);
  const seconds=totalSeconds%60;

  timerEl.textContent=
    String(days).padStart(2,'0')+":"+
    String(hours).padStart(2,'0')+":"+
    String(minutes).padStart(2,'0')+":"+
    String(seconds).padStart(2,'0');

  // Эпичная часть
  if(totalSeconds <=5){
    timerEl.classList.add("shake");
    redAlert.style.opacity = seconds%2?0.4:0;
    playBeep(1400,120,0.5);
    vibrate(120);
  } else if(totalSeconds <=10){
    playBeep(1200,100,0.4);
    vibrate(80);
    timerEl.classList.remove("shake");
    redAlert.style.opacity = 0;
  } else{
    playBeep(800,50,0.2);
    vibrate(40);
    timerEl.classList.remove("shake");
    redAlert.style.opacity = 0;
  }
}

// Для iPhone: тап по экрану для звука
document.body.addEventListener("click",()=>audioCtx.resume());

setInterval(updateTimer,1000);
updateTimer();
</script>

</body>
</html>
