<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Countdown to Valentine</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap'); /* крут для цифровых дисплеев */

body {
  margin:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:'Orbitron', 'Courier New', monospace;
  text-align:center;
  overflow:hidden;
  color:#ff2a2a;
}

#timer {
  font-size:120px;
  font-weight:bold;
  color:#ff2a2a;
  text-shadow: 0 0 15px red, 0 0 40px darkred, 0 0 60px #ff0000;
}

.shake {
  animation: shake 0.1s infinite;
}

@keyframes shake {
  0% { transform: translate(4px, 4px) rotate(1deg); }
  25% { transform: translate(-4px, -4px) rotate(-1deg); }
  50% { transform: translate(4px, -4px) rotate(1deg); }
  75% { transform: translate(-4px, 4px) rotate(-1deg); }
  100% { transform: translate(4px, 4px) rotate(1deg); }
}

#final {
  display:none;
  font-size:60px;
  font-weight:bold;
  color:#ff69b4;
  text-shadow:0 0 25px #ff69b4, 0 0 50px #ff1493;
}

#redAlert {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:red;
  opacity:0;
  pointer-events:none;
  z-index:10;
}

#flash {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:white;
  opacity:0;
  pointer-events:none;
  z-index:11;
}

#tapScreen {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.8);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:32px;
  font-weight:bold;
  letter-spacing:1px;
  z-index:20;
  text-align:center;
  padding:20px;
  text-shadow: 2px 2px 4px #000;
  line-height:1.2;
}
</style>
</head>
<body>

<div id="timer">00:00:00:00</div>
<div id="final">ого блин котята люблю вас</div>
<div id="redAlert"></div>
<div id="flash"></div>
<div id="tapScreen">Нажми на экран, если не боишься</div>

<script>
let audioCtx;
let audioUnlocked = false;

function playBeep(freq=800,duration=50,volume=0.3){
  if(!audioUnlocked) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.frequency.value = freq; osc.type = "square";
  gain.gain.value = volume;
  osc.start();
  setTimeout(()=>osc.stop(),duration);
}

function vibrate(duration){
  if(navigator.vibrate) navigator.vibrate(duration);
}

// Московское время: 14 февраля 00:00 МСК
function getTimeLeftToMoscow(){
    const now = new Date();
    const nowUTC = Date.UTC(
        now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),
        now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds()
    );

    let year = now.getUTCFullYear();
    let targetUTC = Date.UTC(year,1,13,21,0,0); // 14 фев 00:00 МСК = 13 фев 21:00 UTC
    if(nowUTC >= targetUTC){
        year +=1;
        targetUTC = Date.UTC(year,1,13,21,0,0);
    }

    let diff = targetUTC - nowUTC;
    if(diff < 0) diff = 0;

    const totalSeconds = Math.floor(diff / 1000);
    const days = Math.floor(totalSeconds / 86400);
    const hours = Math.floor((totalSeconds % 86400)/3600);
    const minutes = Math.floor((totalSeconds % 3600)/60);
    const seconds = totalSeconds % 60;

    return {days,hours,minutes,seconds,totalSeconds};
}

function updateTimer(){
    const timerEl = document.getElementById("timer");
    const redAlert = document.getElementById("redAlert");
    const {days,hours,minutes,seconds,totalSeconds} = getTimeLeftToMoscow();

    if(totalSeconds <=0){
        timerEl.style.display="none";
        document.getElementById("final").style.display="block";

        playBeep(200,1500,0.5);
        vibrate([300,100,300,100,300]);
        const flash=document.getElementById("flash");
        flash.style.transition="opacity 0.2s";
        flash.style.opacity=1;
        setTimeout(()=>flash.style.opacity=0,300);
        redAlert.style.opacity=0;
        timerEl.classList.remove("shake");
        return;
    }

    timerEl.textContent =
        String(days).padStart(2,'0')+":"+
        String(hours).padStart(2,'0')+":"+
        String(minutes).padStart(2,'0')+":"+
        String(seconds).padStart(2,'0');

    if(totalSeconds <=5){
        timerEl.classList.add("shake");
        redAlert.style.opacity = seconds%2?0.4:0;
        playBeep(1400,80,0.5);
        vibrate(50);
    } else if(totalSeconds <=10){
        playBeep(1200,70,0.4);
        vibrate(40);
        timerEl.classList.remove("shake");
        redAlert.style.opacity = 0;
    } else{
        playBeep(800,50,0.2);
        vibrate(30);
        timerEl.classList.remove("shake");
        redAlert.style.opacity = 0;
    }
}

document.getElementById('tapScreen').addEventListener('click',()=>{
    if(audioUnlocked) return;
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    audioUnlocked = true;
    document.getElementById('tapScreen').style.display='none';

    // короткий beep и вибро для разблокировки
    playBeep(800,50,0.3);
    vibrate(100);

    updateTimer();
});

setInterval(updateTimer,1000);
</script>

</body>
</html>