<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Анимированный QR для ПК и iOS</title>
<style>
body {
  margin:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
}
#qr-container {
  position:relative;
  width:360px;
  height:360px;
  padding:20px;
  background:#111;
  box-shadow:0 0 50px #000 inset;
  border:5px solid #222;
  box-sizing:border-box;
  filter: contrast(1.2) brightness(1.1);
}
#qr { width:100%; height:100%; display:block; position:relative; z-index:1; }
#scratches {
  position:absolute; top:0; left:0; width:100%; height:100%;
  pointer-events:none;
  background-image:
    repeating-linear-gradient(45deg, rgba(255,255,255,0.07) 0, rgba(255,255,255,0.07) 1px, transparent 1px, transparent 5px),
    repeating-linear-gradient(-45deg, rgba(255,255,255,0.07) 0, rgba(255,255,255,0.07) 1px, transparent 1px, transparent 5px);
  z-index:2;
}
#noise {
  position:absolute; top:0; left:0; width:100%; height:100%;
  pointer-events:none;
  background:transparent url('https://i.ibb.co/ZM9RR7p/grain.png') repeat;
  mix-blend-mode:overlay;
  opacity:0.25;
  z-index:3;
}
#bloodCanvas {
  position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:4;
}
</style>
</head>
<body>

<div id="qr-container">
  <canvas id="qr"></canvas>
  <div id="scratches"></div>
  <div id="noise"></div>
  <canvas id="bloodCanvas"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
// --- QR-код ---
const url = "https://poniclan-oss.github.io/valentine_timer/valentine_timer_ios.html";
const qrCanvas = document.getElementById("qr");
QRCode.toCanvas(qrCanvas, url, { errorCorrectionLevel: 'H', margin:1, color: { dark: '#fff', light: '#111' } });

// --- Канвас брызг ---
const bloodCanvas = document.getElementById('bloodCanvas');
const ctx = bloodCanvas.getContext('2d');

function resizeCanvas(){
  // Устанавливаем реальные размеры канваса для правильного отображения на iOS и ПК
  bloodCanvas.width = bloodCanvas.offsetWidth;
  bloodCanvas.height = bloodCanvas.offsetHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let droplets = [];

function random(min,max){ return Math.random()*(max-min)+min; }

function addDroplet(){
  droplets.push({
    x: random(0,bloodCanvas.width),
    y: 0,
    vx: random(-1.5,1.5),
    vy: random(2,5),
    radius: random(2,5),
    alpha:1,
    gravity:0.25,
    fade: random(0.01,0.03)
  });
}

function updateDroplets(){
  ctx.clearRect(0,0,bloodCanvas.width,bloodCanvas.height);
  for(let i=droplets.length-1;i>=0;i--){
    let d = droplets[i];
    d.x += d.vx;
    d.y += d.vy;
    d.vy += d.gravity;
    d.alpha -= d.fade;

    if(d.y + d.radius > bloodCanvas.height){
      d.y = bloodCanvas.height - d.radius;
      d.vy *= -0.4;
      d.vx *= 0.7;
    }

    ctx.beginPath();
    ctx.arc(d.x,d.y,d.radius,0,Math.PI*2);
    ctx.fillStyle = rgba(200,0,0,${d.alpha});
    ctx.fill();

    if(d.alpha<=0) droplets.splice(i,1);
  }
}

function animate(){
  if(Math.random()<0.5) addDroplet();
  updateDroplets();
  requestAnimationFrame(animate);
}

// Добавим несколько капель сразу, чтобы экран не пустой
for(let i=0;i<30;i++) addDroplet();
animate();
</script>

</body>
</html>